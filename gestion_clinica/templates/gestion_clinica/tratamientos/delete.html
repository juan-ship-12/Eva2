{% extends 'gestion_clinica/base.html' %}

{% block title %}Eliminar Tratamiento - Salud Vital{% endblock %}

{% block header_title %}Eliminar Tratamiento{% endblock %}

{% block content %}
<div class="card">
    <h2>âš ï¸ Confirmar EliminaciÃ³n</h2>
    <p>Â¿EstÃ¡ seguro de que desea eliminar este tratamiento del sistema?</p>
    
    <div style="margin-top: 16px;">
        <a href="{% url 'tratamiento-list' %}" class="btn btn-secondary">â† Volver a Tratamientos</a>
    </div>
</div>

<div class="card">
    <h2>Datos del Tratamiento a Eliminar</h2>
    
    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 16px; margin-bottom: 20px;">
        <h3 style="color: #856404; margin: 0 0 12px 0;">âš ï¸ Advertencia</h3>
        <p style="color: #856404; margin: 0;">Esta acciÃ³n no se puede deshacer. Se eliminarÃ¡n todos los datos relacionados con este tratamiento.</p>
    </div>
    
    <div style="background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 20px; margin-bottom: 20px;">
        <h3 style="margin: 0 0 16px 0; color: #24292f;">InformaciÃ³n del Tratamiento</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div>
                <strong>Paciente:</strong> {{ tratamiento.consulta.paciente.nombre }} {{ tratamiento.consulta.paciente.apellido }}
            </div>
            <div>
                <strong>MÃ©dico:</strong> {{ tratamiento.consulta.medico.nombre }} {{ tratamiento.consulta.medico.apellido }}
            </div>
            <div>
                <strong>DuraciÃ³n:</strong> {{ tratamiento.duracion_dias }} dÃ­as
            </div>
            <div>
                <strong>DescripciÃ³n:</strong> {{ tratamiento.descripcion|truncatechars:50 }}
            </div>
            <div>
                <strong>Observaciones:</strong> {{ tratamiento.observaciones|truncatechars:50 }}
            </div>
        </div>
    </div>
    
    <form method="POST" id="deleteForm" style="margin-top: 20px;">
        {% csrf_token %}
        
        <div style="display: flex; gap: 12px; margin-top: 24px;">
            <button type="button" id="deleteBtn" class="btn" style="background: #d73a49; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-weight: 600;">
                ğŸ—‘ï¸ Eliminar Tratamiento
            </button>
            <a href="{% url 'tratamiento-list' %}" class="btn btn-secondary" style="background: #f6f8fa; color: #24292f; border: 1px solid #d0d7de; padding: 12px 24px; border-radius: 6px; text-decoration: none;">
                âŒ Cancelar
            </a>
        </div>
    </form>
</div>

{% if messages %}
    {% for message in messages %}
        <div style="background: #d1ecf1; color: #0c5460; padding: 12px; border-radius: 6px; margin-top: 16px; border: 1px solid #bee5eb;">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<script>
document.getElementById('deleteBtn').addEventListener('click', function() {
    Swal.fire({
        title: 'Â¿EstÃ¡s seguro?',
        text: 'Esta acciÃ³n no se puede deshacer. Se eliminarÃ¡ permanentemente el tratamiento del paciente {{ tratamiento.consulta.paciente.nombre }} {{ tratamiento.consulta.paciente.apellido }}.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d73a49',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'SÃ­, eliminar',
        cancelButtonText: 'Cancelar',
        reverseButtons: true
    }).then((result) => {
        if (result.isConfirmed) {
            // Mostrar loading
            Swal.fire({
                title: 'Eliminando...',
                text: 'Por favor espera',
                allowOutsideClick: false,
                showConfirmButton: false,
                willOpen: () => {
                    Swal.showLoading()
                }
            });
            
            // Enviar formulario
            document.getElementById('deleteForm').submit();
        }
    });
});
</script>
{% endblock %}
