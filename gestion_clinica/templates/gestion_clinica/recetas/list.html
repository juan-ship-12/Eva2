{% extends 'gestion_clinica/base.html' %}

{% block title %}Recetas - Salud Vital{% endblock %}

{% block header_title %}Recetas{% endblock %}

{% block content %}
<div class="card">
    <h2>üìù Gesti√≥n de Recetas</h2>
    <p>Administra las recetas m√©dicas del sistema.</p>
    
    <div style="margin-top: 16px;">
        <a href="{% url 'home' %}" class="btn btn-secondary">‚Üê Volver al Inicio</a>
        <a href="{% url 'receta-create' %}" class="btn btn-primary">+ Agregar Receta</a>
        <a href="/swagger/" class="btn btn-secondary" target="_blank">Ver API Docs</a>
    </div>
</div>

<div class="card">
    <h2>Lista de Recetas</h2>
    <p>Recetas m√©dicas registradas en el sistema.</p>
    
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Paciente</th>
                <th>Medicamento</th>
                <th>Dosis</th>
                <th>Frecuencia</th>
                <th>Duraci√≥n</th>
                <th>Motivo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% if recetas %}
                {% for receta in recetas %}
                <tr>
                    <td>{{ receta.id }}</td>
                    <td>{{ receta.tratamiento.consulta.paciente.nombre }} {{ receta.tratamiento.consulta.paciente.apellido }}</td>
                    <td><strong>{{ receta.medicamento.nombre }}</strong></td>
                    <td>{{ receta.dosis }}</td>
                    <td>{{ receta.get_frecuencia_display }}</td>
                    <td>{{ receta.duracion }}</td>
                    <td>{{ receta.motivo|truncatechars:30 }}</td>
                    <td>
                        <a href="{% url 'receta-edit' receta.id %}" class="btn btn-secondary" style="margin-right: 8px; text-decoration: none;">Editar</a>
                        <a href="{% url 'receta-delete' receta.id %}" class="btn" style="background-color: #d73a49; color: white; text-decoration: none;">Eliminar</a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" style="text-align: center; color: #656d76; padding: 24px;">
                        <p>No hay recetas registradas a√∫n.</p>
                        <p style="font-size: 12px; margin-top: 8px;">
                            Haz clic en "Agregar Receta" para crear la primera.
                        </p>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Informaci√≥n de la API</h2>
    <p>Endpoints disponibles para la gesti√≥n de recetas:</p>
    
    <div style="background: #f6f8fa; padding: 16px; border-radius: 6px; margin-top: 16px;">
        <h3 style="margin-bottom: 16px;">üîó Endpoints Interactivos:</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px;">
            <a href="/api/recetas/" class="btn btn-primary" target="_blank" style="text-decoration: none; display: block; padding: 12px; border-radius: 6px; background: #2da44e; color: white; text-align: center;">
                <strong>GET /api/recetas/</strong><br>
                <small>Listar todas las recetas</small>
            </a>
            <a href="/swagger/" class="btn btn-secondary" target="_blank" style="text-decoration: none; display: block; padding: 12px; border-radius: 6px; background: #f6f8fa; color: #24292f; text-align: center; border: 1px solid #d0d7de;">
                <strong>POST /api/recetas/</strong><br>
                <small>Crear nueva receta (Swagger)</small>
            </a>
            <a href="/swagger/" class="btn btn-secondary" target="_blank" style="text-decoration: none; display: block; padding: 12px; border-radius: 6px; background: #f6f8fa; color: #24292f; text-align: center; border: 1px solid #d0d7de;">
                <strong>PUT/DELETE /api/recetas/{id}/</strong><br>
                <small>Actualizar/Eliminar (Swagger)</small>
            </a>
        </div>
    </div>
</div>

<script>
function agregarReceta() {
    window.open('/swagger/', '_blank');
}

function editarReceta(id) {
    window.open('/swagger/', '_blank');
}

function eliminarReceta(id) {
    if (confirm('¬øEst√°s seguro de que quieres eliminar esta receta?')) {
        alert('Funcionalidad de eliminaci√≥n en desarrollo. Usa Swagger por ahora.');
    }
}
</script>
{% endblock %}
